# port: 7890
# socks-port: 7891
mixed-port: 7890
redir-port: 7891
tproxy-port: 1536
allow-lan: true
mode: rule
geodata-mode: true
bind-address: "*"
unified-delay: true
log-level: silent # silent warning
ipv6: true
external-controller: 0.0.0.0:9090
external-ui: ./dashboard/webroot
secret: ""
tcp-concurrent: true
keep-alive-interval: 30
enable-process: true
find-process-mode: off # off strict
global-client-fingerprint: chrome
geodata-loader: memconservative
geo-auto-update: false
geo-update-interval: 24
geox-url:
  geoip: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geoip.dat"
  geosite: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geosite.dat"
  mmdb: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/country.mmdb"

#####################
#ä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶ï¼Œå»ºè®®å…ˆåœæ­¢æ¨¡å—æœåŠ¡ï¼Œå†è¿›è¡Œä¿å­˜.
#####################

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true # æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ä¸º true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
  force-domain:
    - +.v2ex.com
  skip-domain:
    - Mijia Cloud

tun:
  enable: true
  device: tun0
  stack: mixed # system / gvisor / mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-detect-interface: true

dns:
  enable: true
  prefer-h3: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
    - "connect.rom.miui.com"
    - "localhost.ptlogin2.qq.com"
  default-nameserver: # é»˜è®¤ DNS, ç”¨äºè§£æ DNS æœåŠ¡å™¨ çš„åŸŸåï¼Œå¿…é¡»ä¸º IP æˆ– å¯åŠ å¯†
    - "https://1.1.1.1/dns-query#h3=true"
    - "https://1.12.12.12/dns-query"
    - "1.1.1.1"
    - "119.29.29.29"
  nameserver-policy: # æŒ‡å®šåŸŸåæŸ¥è¯¢çš„è§£ææœåŠ¡å™¨
    "geosite:gfw,geolocation-!cn":
      - "tls://one.one.one.one"
      - "https://cloudflare-dns.com/dns-query#h3=true"
      - "[2606:4700:4700::1111]"
      - "1.1.1.1"
    "geosite:google,youtube":
      - "tls://dns.google"
      - "https://dns.google/dns-query"
      - "[2001:4860:4860::8888]"
      - "8.8.8.8"
    "ipcidr:240.0.0.0/4":
      - "tls://dns.google"
      - "https://dns.google/dns-query"
      - "[2001:4860:4860::8888]"
      - "8.8.8.8"

  nameserver: # é»˜è®¤çš„åŸŸåè§£ææœåŠ¡å™¨
    - "tls://dot.pub"
    - "https://doh.pub/dns-query"
    - "[2402:4e00::]"
    - "119.29.29.29"
  proxy-server-nameserver: # ä»£ç†èŠ‚ç‚¹åŸŸåè§£ææœåŠ¡å™¨
    - "tls://one.one.one.one"
    - "https://cloudflare-dns.com/dns-query#h3=true"
    - "[2606:4700:4700::1111]"
    - "1.1.1.1"

p: &p
  type: http
  interval: 3600
  health-check:
    enable: true
    url: https://www.gstatic.com/generate_204
    interval: 300
u: &u
  use: 
    - provider1
    - provider2

proxy-providers:
  provider1:
    <<: *p
    url: "å¼•å…¥æ‚¨çš„Clashè®¢é˜…é“¾æ¥åœ°å€"
    path: ./provide/subscription1.yaml
    #æ³¨æ„ï¼å¦‚æœæ‚¨çš„è®¢é˜…é“¾æ¥ä¸­å¸¦æœ‰â€œ&â€å­—ç¬¦ï¼Œè¯·åˆ æ‰.
  provider2:
    <<: *p
    url: "å¼•å…¥æ‚¨çš„Clashè®¢é˜…é“¾æ¥åœ°å€"
    path: ./provide/subscription2.yaml
    #æ³¨æ„ï¼å¦‚æœæ‚¨çš„è®¢é˜…é“¾æ¥ä¸­å¸¦æœ‰â€œ&â€å­—ç¬¦ï¼Œè¯·åˆ æ‰.

proxy-groups:
  - {name: ğŸ§­ æ¢ç´¢å¤§é™†, type: select, proxies: [ğŸ—ºï¸ é€‰æ‹©èŠ‚ç‚¹,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3]}
  - {name: ğŸ—ºï¸ é€‰æ‹©èŠ‚ç‚¹, type: select, proxies: [ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸŒ å…¨çƒç›´è¿], <<: *u}
  - {name: ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢, <<: *u, tolerance: 2, type: url-test}
  - {name: ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1, type: select, proxies: [ğŸ—ºï¸ é€‰æ‹©èŠ‚ç‚¹,ğŸŒ å…¨çƒç›´è¿], <<: *u}
  - {name: ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2, type: select, proxies: [ğŸ—ºï¸ é€‰æ‹©èŠ‚ç‚¹,ğŸŒ å…¨çƒç›´è¿], <<: *u}
  - {name: ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3, type: select, proxies: [ğŸ—ºï¸ é€‰æ‹©èŠ‚ç‚¹,ğŸŒ å…¨çƒç›´è¿], <<: *u}
  - {name: âœ‰ï¸ FCMæ¨é€, type: select, proxies: [ğŸŒ å…¨çƒç›´è¿,ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3]}
  - {name: â¬‡ï¸ PT ä¸‹è½½, type: select, proxies: [ğŸŒ å…¨çƒç›´è¿,ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3]}
  - {name: ğŸ“¢ è°·æ­ŒæœåŠ¡, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3,ğŸŒ å…¨çƒç›´è¿]}
  - {name: â“‚ï¸ å¾®è½¯æœåŠ¡, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3,ğŸŒ å…¨çƒç›´è¿]}
  - {name: ğŸ è‹¹æœæœåŠ¡, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3,ğŸŒ å…¨çƒç›´è¿]}
  - {name: ğŸ¤– OpenAI, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3,ğŸŒ å…¨çƒç›´è¿]}
  - {name: ğŸ Netflix, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3,ğŸŒ å…¨çƒç›´è¿]}
  - {name: ğŸ“¹ YouTube, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3,ğŸŒ å…¨çƒç›´è¿]}
  - {name: ğŸ“¸ TikTok, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3,ğŸŒ å…¨çƒç›´è¿]}
  - {name: ğŸ“² Discord, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3,ğŸŒ å…¨çƒç›´è¿]}
  - {name: ğŸ“² Telegram, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒŠ è‡ªåŠ¨åˆ‡æ¢,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢1,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢2,ğŸï¸ æ‰‹åŠ¨åˆ‡æ¢3,ğŸŒ å…¨çƒç›´è¿]}
 # - {name: ğŸ…¿ï¸ ç»•è¿‡æ•°æ®, type: select, proxies: [PASS]}
  - {name: ğŸ›‘ æ‹¦æˆªæ•°æ®, type: select, proxies: [REJECT,REJECT-DROP]}
  - {name: ğŸ‹ æ¼ç½‘ä¹‹é±¼, type: select, proxies: [ğŸ§­ æ¢ç´¢å¤§é™†,ğŸŒ å…¨çƒç›´è¿]}
  - {name: ğŸŒ å…¨çƒç›´è¿, type: select, proxies: [DIRECT]}

rule-providers:
  Tencent:
    type: http
    behavior: classical
    format: yaml
    path: ./rule/Tencent.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Tencent/Tencent.yaml"
    interval: 86400
  GoogleFCM:
    type: http
    behavior: classical
    format: yaml
    path: ./rule/GoogleFCM.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GoogleFCM/GoogleFCM.yaml"
    interval: 86400
  KuaiShou:
    type: http
    behavior: classical
    format: yaml
    path: ./rule/KuaiShou.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/KuaiShou/KuaiShou.yaml"
    interval: 86400

rules:
# å»å¹¿å‘Š
  # - RULE-SET,AdvertisingLite,ğŸ›‘ æ‹¦æˆªæ•°æ®
  - GEOSITE,category-ads-all,ğŸ›‘ æ‹¦æˆªæ•°æ®
# ä¿®å¤ DNS æ³„æ¼
  - IP-CIDR,127.0.0.1/32,ğŸ›‘ æ‹¦æˆªæ•°æ®,no-resolve
  - IP-CIDR,198.18.0.1/16,ğŸ›‘ æ‹¦æˆªæ•°æ®,no-resolve
  - IP-CIDR,28.0.0.1/8,ğŸ›‘ æ‹¦æˆªæ•°æ®,no-resolve
  - IP-CIDR6,::1/128,ğŸ›‘ æ‹¦æˆªæ•°æ®,no-resolve
  - RULE-SET,Tencent,ğŸŒ å…¨çƒç›´è¿
  - RULE-SET,GoogleFCM,âœ‰ï¸ FCMæ¨é€
  - GEOSITE,cloudflare@cn,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,cloudflare,ğŸ§­ æ¢ç´¢å¤§é™†
  - GEOSITE,tracker,â¬‡ï¸ PT ä¸‹è½½
  - GEOSITE,category-games@cn,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,category-games,ğŸ§­ æ¢ç´¢å¤§é™†
  - GEOSITE,openai,ğŸ¤– OpenAI
  - RULE-SET,KuaiShou,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,tiktok,ğŸ“¸ TikTok
  - GEOSITE,bytedance,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,biliintl,ğŸ§­ æ¢ç´¢å¤§é™†
  - GEOSITE,bilibili,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,netflix,ğŸ Netflix
  - GEOSITE,discord,ğŸ“² Discord
  - GEOSITE,telegram,ğŸ“² Telegram
  - GEOSITE,apple@cn,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,apple,ğŸ è‹¹æœæœåŠ¡
  - GEOSITE,onedrive,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,microsoft@cn,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,microsoft,â“‚ï¸ å¾®è½¯æœåŠ¡
  - DOMAIN,googleapis.cn,ğŸ§­ æ¢ç´¢å¤§é™†
  - GEOSITE,google@cn,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,youtube,ğŸ“¹ YouTube
  - GEOSITE,google,ğŸ“¢ è°·æ­ŒæœåŠ¡
  - GEOIP,private,ğŸŒ å…¨çƒç›´è¿,no-resolve
  - GEOSITE,private,ğŸŒ å…¨çƒç›´è¿
  - GEOIP,cn,ğŸŒ å…¨çƒç›´è¿,no-resolve
  - GEOSITE,cn,ğŸŒ å…¨çƒç›´è¿
# rules inner, recommended untuk non kuota reguler
  - AND,((PROCESS-NAME,clash),(NOT,((IN-TYPE,inner)))),REJECT
  - IN-TYPE,inner,ğŸ§­ æ¢ç´¢å¤§é™†
  - MATCH,ğŸ‹ æ¼ç½‘ä¹‹é±¼
